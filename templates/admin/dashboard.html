{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4 text-center fw-bold">ðŸ“Š Admin Dashboard</h2>

  <!-- Users Section -->
  <div class="card shadow-lg mb-5">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">ðŸ‘¤ Registered Users</h5>
    </div>
    <div class="card-body table-responsive">
      {% if users %}
      <table class="table table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>User ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Wallet Balance</th>
            <th>Created At</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr>
            <td>{{ u.UserID }}</td>
            <td>{{ u.Name }}</td>
            <td>{{ u.Email }}</td>
            <td>
              {% if u.wallets and u.wallets[0].Balance %}
                â‚¹{{ "%.2f"|format(u.wallets[0].Balance) }}
              {% else %}
                â‚¹0.00
              {% endif %}
            </td>
            <td>{{ u.CreatedAt.strftime('%Y-%m-%d') if u.CreatedAt else '' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-muted text-center">No users found.</p>
      {% endif %}
    </div>
  </div>

  <!-- Orders Section -->
  <div class="card shadow-lg mb-5">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0">ðŸ›’ Orders</h5>
    </div>
    <div class="card-body table-responsive">
      {% if orders %}
      <table class="table table-striped align-middle">
        <thead class="table-dark">
          <tr>
            <th>Order ID</th>
            <th>User</th>
            <th>Crypto</th>
            <th>Type</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Status</th>
            <th>Timestamp</th>
          </tr>
        </thead>
        <tbody>
          {% for o in orders %}
          <tr>
            <td>{{ o.OrderID }}</td>
            <td>{{ o.user.Name if o.user else 'â€”' }}</td>
            <td>{{ o.crypto.Symbol if o.crypto else 'â€”' }}</td>
            <td>{{ o.OrderType }}</td>
            <td>{{ o.Quantity }}</td>
            <td>â‚¹{{ o.Price }}</td>
            <td>{{ o.Status }}</td>
            <td>{{ o.Timestamp.strftime('%Y-%m-%d %H:%M') if o.Timestamp else '' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-muted text-center">No orders placed yet.</p>
      {% endif %}
    </div>
  </div>

  <!-- Portfolio Section -->
  <div class="card shadow-lg mb-5">
    <div class="card-header bg-warning text-dark">
      <h5 class="mb-0">ðŸ“ˆ User Portfolios</h5>
    </div>
    <div class="card-body table-responsive">
      {% if portfolios %}
      <table class="table table-bordered align-middle">
        <thead class="table-dark">
          <tr>
            <th>Portfolio ID</th>
            <th>User</th>
            <th>Crypto</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody>
          {% for p in portfolios %}
          <tr>
            <td>{{ p.PortfolioID }}</td>
            <td>{{ p.user.Name if p.user else 'â€”' }}</td>
            <td>{{ p.crypto.Symbol if p.crypto else 'â€”' }}</td>
            <td>{{ "%.2f"|format(p.Quantity or 0) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-muted text-center">No portfolio data available.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
